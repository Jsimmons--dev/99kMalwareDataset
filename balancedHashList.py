#save hashes by top family until you reach $perClass of each one
import csv

familyMap = dict()
familyList = []
total = 0
perClass = 10000
#VirusShare.labels created outside of this repo. Provided by s3 bucket download
with open('VirusShare.labels') as f:
    tsvin = csv.reader(f, delimiter='\t')

    #topFamiles.csv generated with shell commands from VirusShare.families in format of '$family'
    with open('topFamilies.csv') as tops:
        for family in tops:
            familyList.append(family.rstrip())

        maxTotal = perClass * len(familyList)

        for malware in tsvin:
            if total <= maxTotal:
                hash = malware[0]
                familyName = malware[1]
                if familyName in familyList:
                    if familyName in familyMap:
                        if len(familyMap[familyName]) < perClass:
                            familyMap[familyName].append(hash)
                            total += 1
                    else:
                        familyMap[familyName] = [hash]
                        total += 1
            else:
                break

        for family in familyMap:
            for malware in familyMap[family]:
                print malware + "," + family
